<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        td.rule-name, th.rule-name {
            white-space: nowrap;
        }
        td, th {
            word-break: break-word;
            white-space: normal;
            max-width: 500px; 
        }
    </style>
    <title>System Vulnerability Scanner</title>
<script>
function getFirewallRules() {
    fetch('/get_firewall_rules', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        // Only show selected columns, start each row with Rule Name, remove Grouping and Remote IP
        if (data.rules && Array.isArray(data.rules) && data.rules.length > 0) {
            let table = "<table border='1'><tr><th>Rule Name</th><th style='width:100px;'>LocalPort</th><th>Direction</th><th>Action</th></tr>";
            data.rules.forEach(rule => {
                table += "<tr>";
                table += `<td>${rule["Rule Name"] || rule["rule name"] || ""}</td>`;
                table += `<td>${rule["LocalPort"] || rule["localport"] || ""}</td>`;
                table += `<td>${rule["Direction"] || rule["direction"] || ""}</td>`;
                table += `<td>${rule["Action"] || rule["action"] || ""}</td>`;
                table += "</tr>";
            });
            table += "</table>";
            document.getElementById('firewallOutput').innerHTML = table;
        } else {
            document.getElementById('firewallOutput').textContent = data.error || "No rules found.";
        }
    })
    .catch(error => {
        document.getElementById('firewallOutput').textContent = 'Error fetching firewall rules';
        document.getElementById('suggestions').innerHTML = '';
    });
}
function getFirewallVulnerabilities() {
    fetch('/get_firewall_rules', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.vulnerable_rules && Object.keys(data.vulnerable_rules).length > 0) {
            // Convert object to array for sorting
            let rulesArr = Object.entries(data.vulnerable_rules).map(([ruleName, rule]) => ({
                ruleName,
                localport: parseInt(rule.LocalPort || rule.localport) || 65535,
                direction: rule.Direction || rule.direction || "",
                action: rule.Action || rule.action || ""
            }));
            // Sort by localport ascending
            rulesArr.sort((a, b) => a.localport - b.localport);

            let vulnTable = "<b>Potentially Vulnerable Rules:</b><table border='1'><tr><th>Rule Name</th><th style='width:100px;'>LocalPort</th><th>Direction</th><th>Action</th><th>Suggested Fix</th></tr>";
            for (let rule of rulesArr) {
                let fix = "Consider changing Action to 'Block' or restricting allowed sources/ports.";
                vulnTable += `<tr>
                    <td>${rule.ruleName}</td>
                    <td>${rule.localport !== 65535 ? rule.localport : ""}</td>
                    <td>${rule.direction}</td>
                    <td>${rule.action}</td>
                    <td>${fix}</td>
                </tr>`;
            }
            vulnTable += "</table>";
            document.getElementById('firewallOutput').innerHTML = "";
            document.getElementById('suggestions').innerHTML = vulnTable;
        } else {
            document.getElementById('firewallOutput').innerHTML = "";
            document.getElementById('suggestions').innerHTML = "<b>No vulnerable rules detected.</b>";
        }
    })
    .catch(error => {
        document.getElementById('firewallOutput').innerHTML = "";
        document.getElementById('suggestions').innerHTML = 'Error fetching vulnerable rules';
    });
}
</script>
</head>
<body>
    <h1>Welcome to Your System Vulnerability Dashboard</h1>
    <a href="/"><button>Return to Main Page</button></a>
    <a href="/vulnerability_scanner"><button>Go to Vulnerability Scanner</button></a>
    <a href="/penetration_tester"><button>Go to Penetration Tester</button></a>
    <a href="/packet_sniffer"><button>Go to Packet Sniffer</button></a>
    <button onclick="getFirewallRules()">Get Firewall Rules</button>
    <button onclick="getFirewallVulnerabilities()">Display Vulnerable Rules</button>
    <pre id="firewallOutput"></pre>
    <div id="suggestions"></div>
</body>
</html>